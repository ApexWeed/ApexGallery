function galleryLoad(){if(window.location.hash==="")$.ajax("/API/{0}/Directory".format($("#lang").text())).done(function(n){var t,i,r;if(n.success)for(t in n.directories)n.directories.hasOwnProperty(t)&&(i=n.directories[t],r=$('<div class="dir unknown"><\/div>').appendTo(".dirs"),$('<a href="#{0}">{1}<\/a>'.format(i.path,i.name)).appendTo(r).click(dirClick));else $(".dirs").append("<p>failed to load directory<\/p>")});else{var n=decodeURIComponent(window.location.hash).substr(1).split("|"),t;t=n.length===2?n[1]:0;n=n[0];$.ajax("/API/Count/{0}".format(n)).done(function(i){if(i.success){$("#count").html(i.count);var r=$('<a href="#{0}|{1}"><\/a>'.format(n,t));loadDirectory(r)}});$.ajax("/API/{0}/Directory".format($("#lang").text())).done(function(t){var i,r,u,f,e;if(t.success){for(i in t.directories)t.directories.hasOwnProperty(i)&&(r=t.directories[i],u=$('<div class="dir unknown"><\/div>').appendTo(".dirs"),$('<a href="#{0}">{1}<\/a>'.format(r.path,r.name)).appendTo(u).click(dirClick));f=n.split(":")[0];e=$('a[href="#{0}"]'.format(f)).parent();loadSubDirs(e,n)}else $(".dirs").append("<p>failed to load directory<\/p>")})}window.onclick=function(n){$(n.target).hasClass("page")&&loadDirectory(n.target)}}function dirClick(){var n=$(this).parent();loadDirectory(n);$(n).hasClass("unknown")?loadSubDirs(n):$(n).hasClass("closed")?open(n):$(n).hasClass("open")&&close(n)}function loadSubDirs(n,t){$.ajax("/API/{0}/Directory/{1}".format($("#lang").text(),$("a",n).attr("href").substr(1))).done(function(i){var c,o,s,l,u,f,r,e,h;if(i.success)if(i.directories.length>0){c=$('<div class="content"><\/div>').appendTo(n);for(o in i.directories)i.directories.hasOwnProperty(o)&&(s=i.directories[o],l=$('<div class="dir unknown"><\/div>').appendTo(c),$('<a href="#{0}">{1}<\/a>'.format(s.path,s.name)).appendTo(l).click(dirClick));if($(n).removeClass("unknown").addClass("open"),t!==undefined&&(u=$("a",n).attr("href").split(":").length,f=t.split(":"),f.length>u)){for(r="",e=0;e<u;e++)r+="{0}:".format(f[e]);r+=f[u];h=$('a[href="#{0}"]'.format(r)).parent();console.log(r,h);loadSubDirs(h,r)}}else $(n).removeClass("unknown").addClass("empty");else $(n).append("<content>failed to load directory<\/content>")})}function open(n){$(n).removeClass("closed").addClass("open")}function close(n){$(n).removeClass("open").addClass("closed")}function loadDirectory(n){var i=50,t,r;$(n).tagName()!=="DIV"||$(n).hasClass("active")?$(n).tagName()==="A"&&(t=$(n).attr("href").substr(1).split("|"),r=t[1],t=t[0],$.ajax("/API/{0}/Images/{1}/{2}".format($("#lang").text(),t,r)).done(function(n){var e,f,l,s,c,y,o,u;if(n.success){e=$(".images");e.empty();for(l in n.images)n.images.hasOwnProperty(l)&&(s=n.images[l],$(e).append('<a data-fancybox="gallery" href="{0}"><img src="{1}"><\/a>'.format(s.path,s.thumb,s.name)));f=$(".controls");f.empty();var h=$("#count").text(),a=((h-1)/i>>0)+1,v=r-i;for(v<0&&(v=0),c=r+i,c>h-i&&(c=h-i),y=r/i>>0,o='<a class="page" href="#{0}|0">&lt;&lt;<\/a> <a class="page" href="#{0}|{1}">&lt;<\/a> '.format(t,v),u=0;u<a;u++)o+=u===y?'<a class="page current" href="#{0}|{1}">{2}<\/a> '.format(t,u*i,u+1):'<a class="page" href="#{0}|{1}">{2}<\/a> '.format(t,u*i,u+1);o+='<a class="page" href="#{0}|{1}">&gt;<\/a> <a class="page" href="#{0}|{2}">&gt;&gt;<\/a> '.format(t,a===1?0:c,(a-1)*i);o+="<br /><span>{0}<\/span> total".format(h);f.html(o)}else e=$(".images"),e.empty(),f=$(".controls"),f.empty(),f.html("Couldn't load images.")})):(t=$("a",n).attr("href").substr(1),$.ajax("/API/{0}/Images/{1}".format($("#strings #lang").text(),t)).done(function(r){var f,u,o,e;if(r.success){$(".active").removeClass("active");$(n).addClass("active");f=$(".images");f.empty();for(o in r.images)r.images.hasOwnProperty(o)&&(e=r.images[o],$(f).append('<a data-fancybox="gallery" href="{0}"><img src="{1}"><\/a>'.format(e.path,e.thumb,e.name)));u=$(".controls");u.empty();$.ajax("/API/Count/{0}".format(t)).done(function(n){var e,r,f;if(n.success){for(e=((n.count-1)/i>>0)+1,r='<a class="page" href="#{0}|0">&lt;&lt;<\/a> <a class="page" href="#{0}|0">&lt;<\/a> '.format(t),f=0;f<e;f++)r+='<a class="page" href="#{0}|{1}">{2}<\/a> '.format(t,f*i,f+1);r+='<a class="page" href="#{0}|{1}">&gt;<\/a> <a class="page" href="#{0}|{2}">&gt;&gt;<\/a> <br />'.format(t,e===1?0:i,(e-1)*i);r+=$("#strings #total").text().format(n.count);u.html(r);$("#count").html(n.count)}else u.html("Couldn't load image count.")})}else f=$(".images"),f.empty(),u=$(".controls"),u.empty(),u.html("Couldn't load images.")}))}jQuery.fn.tagName=function(){return this.prop("tagName")};String.prototype.format==undefined&&(String.prototype.format=function(n){var t=undefined,i;return typeof n=="object"?t=function(t,i){return n[i]}:(i=arguments,t=function(n,t){return i[parseInt(t)]}),this.replace(/\{(\w+)\}/g,t)});$(document).ready(function(){$.fancybox.defaults.loop=!0;$.fancybox.defaults.slideShow.speed=1e3;$("dirs")!==null&&galleryLoad()});