function galleryLoad(){var n,t;window.location.hash==""?$.ajax("/API/{0}/Directory".format($("#lang").text())).done(function(n){var i,t,r;if(n.success)for(i in n.directories)t=n.directories[i],r=$('<div class="dir unknown"><\/div>').appendTo(".dirs"),$('<a href="#{0}">{1}<\/a>'.format(t.path,t.name)).appendTo(r).click(dirClick);else $(".dirs").append("<p>failed to load directory<\/p>")}):(n=decodeURIComponent(window.location.hash).substr(1).split("|"),t=n.length==2?n[1]:0,n=n[0],$.ajax("/API/Count/{0}".format(n)).done(function(i){if(i.success){$("#count").html(i.count);var r=$('<a href="#{0}|{1}"><\/a>'.format(n,t));loadDirectory(r)}}),$.ajax("/API/{0}/Directory".format($("#lang").text())).done(function(t){var r,i,u,f,e;if(t.success){for(r in t.directories)i=t.directories[r],u=$('<div class="dir unknown"><\/div>').appendTo(".dirs"),$('<a href="#{0}">{1}<\/a>'.format(i.path,i.name)).appendTo(u).click(dirClick);f=n.split(":")[0];e=$('a[href="#{0}"]'.format(f)).parent();loadSubDirs(e,n)}else $(".dirs").append("<p>failed to load directory<\/p>")}));window.onclick=function(n){$(n.target).hasClass("page")&&loadDirectory(n.target)}}function dirClick(){var n=$(this).parent();loadDirectory(n);$(n).hasClass("unknown")?loadSubDirs(n):$(n).hasClass("closed")?open(n):$(n).hasClass("open")&&close(n)}function loadSubDirs(n,t){$.ajax("/API/{0}/Directory/{1}".format($("#lang").text(),$("a",n).attr("href").substr(1))).done(function(i){var s,h,e,c,r,u,f,o;if(i.success)if(i.directories.length>0){s=$('<div class="content"><\/div>').appendTo(n);for(h in i.directories)e=i.directories[h],c=$('<div class="dir unknown"><\/div>').appendTo(s),$('<a href="#{0}">{1}<\/a>'.format(e.path,e.name)).appendTo(c).click(dirClick);if($(n).removeClass("unknown").addClass("open"),t!==undefined&&(r=$("a",n).attr("href").split(":").length,u=t.split(":"),u.length>r)){for(targetPath="",f=0;f<r;f++)targetPath+="{0}:".format(u[f]);targetPath+=u[r];o=$('a[href="#{0}"]'.format(targetPath)).parent();console.log(targetPath,o);loadSubDirs(o,targetPath)}}else $(n).removeClass("unknown").addClass("empty");else $(n).append("<content>failed to load directory<\/content>")})}function open(n){$(n).removeClass("closed").addClass("open")}function close(n){$(n).removeClass("open").addClass("closed")}function loadDirectory(n){var i=50,t,r;$(n).tagName()!="DIV"||$(n).hasClass("active")?$(n).tagName()=="A"&&(t=$(n).attr("href").substr(1).split("|"),r=t[1],t=t[0],$.ajax("/API/{0}/Images/{1}/{2}".format($("#lang").text(),t,r)).done(function(n){var a,s,c,y,o,u,e,f;if(n.success){e=$(".images");e.empty();for(a in n.images)s=n.images[a],$(e).append('<a href="{0}"><img src="{1}"><\/a>'.format(s.path,s.thumb,s.name));f=$(".controls");f.empty();var h=$("#count").text(),v=(h/i>>0)+1,l=r-i;for(l<0&&(l=0),c=r+i,c>h-i&&(c=h-i),y=r/i>>0,o='<a class="page" href="#{0}|0">&lt;&lt;<\/a> <a class="page" href="#{0}|{1}">&lt;<\/a> '.format(t,l),u=0;u<v;u++)o+=u==y?'<a class="page current" href="#{0}|{1}">{2}<\/a> '.format(t,u*i,u+1):'<a class="page" href="#{0}|{1}">{2}<\/a> '.format(t,u*i,u+1);o+='<a class="page" href="#{0}|{1}">&gt;<\/a> <a class="page" href="#{0}|{2}">&gt;&gt;<\/a> '.format(t,c,(v-1)*i);o+="<br /><span>{0}<\/span> total".format(h);f.html(o)}else e=$(".images"),e.empty(),f=$(".controls"),f.empty(),f.html("Couldn't load images.")})):(t=$("a",n).attr("href").substr(1),$.ajax("/API/{0}/Images/{1}".format($("#strings #lang").text(),t)).done(function(r){var o,e,f,u;if(r.success){$(".active").removeClass("active");$(n).addClass("active");f=$(".images");f.empty();for(o in r.images)e=r.images[o],$(f).append('<a href="{0}"><img src="{1}"><\/a>'.format(e.path,e.thumb,e.name));u=$(".controls");u.empty();$.ajax("/API/Count/{0}".format(t)).done(function(n){var e,r,f;if(n.success){for(e=(n.count/i>>0)+1,r='<a class="page" href="#{0}|0">&lt;&lt;<\/a> <a class="page" href="#{0}|0">&lt;<\/a> '.format(t),f=0;f<e;f++)r+='<a class="page" href="#{0}|{1}">{2}<\/a> '.format(t,f*i,f+1);r+='<a class="page" href="#{0}|{1}">&gt;<\/a> <a class="page" href="#{0}|{2}">&gt;&gt;<\/a> <br />'.format(t,i,(e-1)*i);r+=$("#strings #total").text().format(n.count);u.html(r);$("#count").html(n.count)}else u.html("Couldn't load image count.")})}else f=$(".images"),f.empty(),u=$(".controls"),u.empty(),u.html("Couldn't load images.")}))}jQuery.fn.tagName=function(){return this.prop("tagName")};String.prototype.format==undefined&&(String.prototype.format=function(n){var t=undefined,i;return typeof n=="object"?t=function(t,i){return n[i]}:(i=arguments,t=function(n,t){return i[parseInt(t)]}),this.replace(/\{(\w+)\}/g,t)});$(document).ready(function(){$("dirs")!==null&&galleryLoad()});